<!--
@license
Copyright (c) 2015 Udacity. All rights reserved.
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../earth-img/earth-img.html">

<dom-module id="planet-thumb">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: block;
      }
      svg {
        display: block;
      }
      circle {
        transform: translate(30px, 50px);
      }
      .planet-comparison {
        background: #000000;
        width: 180px;
        height: 100px;
      }
      .no-radius {
        color: white;
        font-size: 2em;
        padding-left: 35px;
      }
      .no-radius::after{
        content: "?";
      }
      earth-img {
        padding-top: 20px;
        padding-right: 10px;
      }
      @media screen and (max-width: 435px) {
        .top {
          /* I'm only doing this because I have to... */
          display: block !important;
          /* TODO: center */
          margin-left: auto;
          margin-right: auto;
        }
      }
      @media screen and (min-width: 436px) {
        .top {
          display: flex;
        }
        .planet-comparison {
        }
        .top-right {
          padding-left: 32px;
        }
        .title {
          margin-top: 0px;
          font-weight: bold;
          font-size: 1.2em;
        }
      }
    </style>
    <a href$="/planet/{{pl_name}}" on-click="setContext">
      <div class="top layout horizontal">
        <div class="planet-comparison layout horizontal justified">
          <p class="no-radius" hidden="{{radiusScale}}"></p>
          <svg width="200px">
            <g fill$="{{color}}" stroke-width="0.5">
              <circle r$="{{exoHalfWidth}}" />
            </g>
          </svg>
          <earth-img width="60px"></earth-img>
        </div>
        <div class="top-right">
          <p class="title">{{pl_name}}</p>
          <p>{{distance}} lightyears away</p>
          <p>Discovered in {{pl_disc}} with {{pl_telescope}}</p>
        </div>
      </div>
    </a>
  </template>

  <script>
    (function () {
      'use strict';

      Polymer({
        is: 'planet-thumb',
        properties: {
          pl_name: {
            type: String,
            notify: true
          },
          pl_rade: {
            type: Number,
            notify: true
          },
          pl_radj: {
          	type: Number,
          	notify: true
          },
          radiusScale: {
            type: Number,
            computed: 'getRadiusScale(pl_rade, pl_radj)',
            observer: 'changeSizes'
          },
          exoHalfWidth: {
            type: Number,
            notify: true,
            value: 40
          },
          exoDisplay: {
            type: String,
            notify: true,
            value: "none"
          },
          exoTranslateX: {
            type: Number,
            notify: true,
            value: 0
          },
          exoTranslateY: {
            type: Number,
            notify: true,
            value: 0
          },
          st_dist: {
          	type: Number,
          	notify: true
          },
          distance: {
            type: Number,
            computed: 'pcToLy(st_dist)'
          },
          pl_massj: {
            type: Number,
            notify: true
          },
          pl_masse: {
            type: Number,
            notify: true
          },
          pl_eqt: {
          	type: Number,
          	notify: true,
            value: 0
          },
          color: {
            type: String,
            notify: true,
            computed: 'tempToColor(pl_eqt)',
            value: 'brown'
          },
          pl_telescope: {
            type: String,
            notify: true,
            value: 'unknown'
          },
          pl_disc: {
            type: Number,
            notify: true,
            value: 'unknown'
          }
        },
        ready: function() {
          // console.log(this.properties);
        },
        setContext: function() {
          // var planetInfo = document.querySelector('planet-info');
          // for (let d in this.planetInfo) {
          //   planetInfo[d] = this.planetInfo[d];
          // }
        },
        getRadiusScale: function(earthRad, jupiterRad) {
          // don't have either radius
          if (!earthRad && !jupiterRad) {
            return 0;
          } else if (earthRad) {
            return earthRad;
          } else {
            return jupiterRad * 11.2;
          }
        },
        pcToLy: function(dist) {
          // gotta respect sigfigs
          let digits = dist.toString().length;
          var ly = (dist / 3.26).toString();
          ly = ly.slice(0,digits);
          return ly;
        },
        tempToColor: function(temp) {
          return "brown";
        },
        changeSizes: function() {
          let circle = this.querySelector('circle');
          this.exoHalfWidth = 30 * this.radiusScale;

          if (this.exoHalfWidth > 60) {
            let diff = 30 - (this.exoHalfWidth - 60);
            circle.style.transform = "translate(" + diff + "px, 50px)";
            circle.style.webkitTransform = "translate(" + diff + "px, 50px)";
          } else if (this.exoHalfWidth === 0) {
            circle.style.display = "none";
          }
        }
      });
    })();
  </script>

</dom-module>
